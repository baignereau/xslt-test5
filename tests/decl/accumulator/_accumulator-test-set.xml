<?xml version="1.0" encoding="UTF-8"?>
<test-set xmlns="http://www.w3.org/2012/10/xslt-test-catalog" xmlns:xs="http://www.w3.org/2001/XMLSchema" name="accumulator">
   <description>Tests accumulator</description>
   <environment name="accumulator-001">
      <source role="." file="accumulator-001.xml"/>
   </environment>
   <environment name="accumulator-001s">
      <source role="." file="accumulator-001.xml" streaming="true"/>
   </environment>
   <environment name="accumulator-002">
      <source role="." file="accumulator-002.xml"/>
   </environment>
   <environment name="accumulator-002s">
      <source role="." file="accumulator-002.xml" streaming="true"/>
   </environment>
   <environment name="accumulator-004">
      <source role="." file="accumulator-004.xml"/>
   </environment>
   <environment name="accumulator-004s">
      <source role="." file="accumulator-004.xml" streaming="true"/>
   </environment>
   <environment name="accumulator-005">
      <source role="." file="accumulator-005.xml"/>
   </environment>
   <environment name="accumulator-005s">
      <source role="." file="accumulator-005.xml" streaming="true"/>
   </environment>
   <environment name="accumulator-015s">
      <source role="." file="accumulator-015.xml" streaming="true"/>
   </environment>
   <dependencies>
      <spec value="XSLT30+"/>
   </dependencies>

   <test-case name="accumulator-001">
      <description>Basic test of accumulator functions</description>
      <keywords>xsl:mode on-no-match-attribute shallow-skip fn:accumulator-before ElementTest</keywords>
      <created by="Michael Kay" on="2012-11-07"/>
      <environment ref="accumulator-001"/>
      <test>
         <stylesheet file="accumulator-001.xsl"/>
      </test>
      <result>
         <assert-xml><![CDATA[<figures><p>Figure 1: a diagram</p><p>Figure 2: another diagram</p><p>Figure 1: a third diagram</p><p>Figure 2: a fourth diagram</p></figures>]]></assert-xml>
      </result>
   </test-case>

   <test-case name="accumulator-002">
      <description>Basic test of accumulator functions - streaming</description>
      <keywords>xsl:mode on-no-match-attribute shallow-skip fn:accumulator-before ElementTest streamable</keywords>
      <created by="Michael Kay" on="2012-11-07"/>
      <environment ref="accumulator-001s"/>
      <dependencies>
         <feature value="streaming"/>
      </dependencies>
      <test>
         <stylesheet file="accumulator-002.xsl"/>
      </test>
      <result>
         <assert-xml><![CDATA[<figures><p>Figure 1: a diagram</p><p>Figure 2: another diagram</p><p>Figure 1: a third diagram</p><p>Figure 2: a fourth diagram</p></figures>]]></assert-xml>
      </result>
   </test-case>

   <test-case name="accumulator-003">
      <description>Pre-descent accumulator functions called before and after</description>
      <keywords>xsl:mode on-no-match-attribute shallow-skip fn:accumulator-before</keywords>
      <created by="Michael Kay" on="2012-11-07"/>
      <environment ref="accumulator-002"/>
      <test>
         <stylesheet file="accumulator-003.xsl"/>
      </test>
      <result>
         <assert-xml><![CDATA[<figures><pix><p>Figure 1 start</p><p>Figure 1 end</p></pix
            ><pix><p>Figure 6 start</p><p>Figure 6 end</p></pix
            ><pix><p>Figure 1 start</p><p>Figure 1 end</p></pix
            ><pix><p>Figure 6 start</p><p>Figure 6 end</p></pix></figures>]]></assert-xml>
      </result>
   </test-case>

   <test-case name="accumulator-004">
      <description>Pre-descent accumulator functions called before and after - streaming</description>
      <keywords>xsl:mode on-no-match-attribute shallow-skip fn:accumulator-before streamable</keywords>
      <created by="Michael Kay" on="2012-11-07"/>
      <environment ref="accumulator-002s"/>
      <dependencies>
         <feature value="streaming"/>
      </dependencies>
      <test>
         <stylesheet file="accumulator-004.xsl"/>
      </test>
      <result>
         <assert-xml><![CDATA[<figures><pix><p>Figure 1 start</p><p>Figure 1 end</p></pix
            ><pix><p>Figure 6 start</p><p>Figure 6 end</p></pix
            ><pix><p>Figure 1 start</p><p>Figure 1 end</p></pix
            ><pix><p>Figure 6 start</p><p>Figure 6 end</p></pix></figures>]]></assert-xml>
      </result>
   </test-case>

   <test-case name="accumulator-005">
      <description>Pre-descent and post-descent accumulator functions</description>
      <keywords>xsl:mode on-no-match-attribute shallow-skip fn:accumulator-before fn:accumulator-after</keywords>
      <created by="Michael Kay" on="2012-11-07"/>
      <environment ref="accumulator-002"/>
      <test>
         <stylesheet file="accumulator-005.xsl"/>
      </test>
      <result>
         <assert-xml><![CDATA[<figures><pix><p>Figure 1 start</p><p>Figure 1.5 end</p></pix
            ><pix><p>Figure 2.5 start</p><p>Figure 3 end</p></pix
            ><pix><p>Figure 1 start</p><p>Figure 1.5 end</p></pix
            ><pix><p>Figure 2.5 start</p><p>Figure 3 end</p></pix></figures>]]></assert-xml>
      </result>
   </test-case>

   <test-case name="accumulator-006">
      <description>Pre-descent and post-descent accumulator functions - streaming</description>
      <keywords>xsl:mode on-no-match-attribute shallow-skip fn:accumulator-before fn:accumulator-after streamable</keywords>
      <created by="Michael Kay" on="2012-11-07"/>
      <environment ref="accumulator-002s"/>
      <dependencies>
         <feature value="streaming"/>
      </dependencies>
      <test>
         <stylesheet file="accumulator-006.xsl"/>
      </test>
      <result>
         <assert-xml><![CDATA[<figures><pix><p>Figure 1 start</p><p>Figure 1.5 end</p></pix
            ><pix><p>Figure 2.5 start</p><p>Figure 3 end</p></pix
            ><pix><p>Figure 1 start</p><p>Figure 1.5 end</p></pix
            ><pix><p>Figure 2.5 start</p><p>Figure 3 end</p></pix></figures>]]></assert-xml>
      </result>
   </test-case>

   <test-case name="accumulator-007">
      <description>Multiple accumulators used in parallel</description>
      <keywords>xsl:mode on-no-match-attribute shallow-skip multiple-accumulators fn:accumulator-after</keywords>
      <created by="Michael Kay" on="2012-11-07"/>
      <environment ref="accumulator-004"/>
      <test>
         <stylesheet file="accumulator-007.xsl"/>
      </test>
      <result>
         <assert-xml><![CDATA[<result min="-16" max="182" sum="277.43" count="16" avg="17.34"/>]]></assert-xml>
      </result>
   </test-case>

   <test-case name="accumulator-008">
      <description>Multiple accumulators used in parallel - with streaming</description>
      <keywords>xsl:mode on-no-match-attribute shallow-skip multiple-accumulators fn:accumulator-after streamable</keywords>
      <created by="Michael Kay" on="2012-11-07"/>
      <environment ref="accumulator-004s"/>
      <dependencies>
         <feature value="streaming"/>
      </dependencies>
      <test>
         <stylesheet file="accumulator-008.xsl"/>
      </test>
      <result>
         <assert-xml><![CDATA[<result min="-16" max="182" sum="277.43" count="16" avg="17.34"/>]]></assert-xml>
      </result>
   </test-case>

   <test-case name="accumulator-009">
      <description>Error: post-descent accumulator function used in a pre-descent instruction</description>
      <keywords>xsl:mode on-no-match-attribute deep-skip multiple-accumulators fn:accumulator-after streamable</keywords>
      <created by="Michael Kay" on="2012-11-07"/>
      <environment ref="accumulator-004s"/>
      <test>
         <stylesheet file="accumulator-009.xsl"/>
      </test>
      <result>
         <error code="XXXX9999"/>
      </result>
   </test-case>

   <test-case name="accumulator-010">
      <description>Hierarchic section numbers: uses accumulator rules with phase=end</description>
      <keywords>xsl:mode on-no-match-attribute shallow-copy fn:accumulator-before</keywords>
      <created by="Michael Kay" on="2012-11-07"/>
      <environment ref="accumulator-005"/>
      <dependencies/>
      <test>
         <stylesheet file="accumulator-010.xsl"/>
      </test>
      <result>
         <assert-xml><![CDATA[<doc><span>1</span><span>Intro</span><p>In the beginning</p
            ><span>1.1</span><span>Terminology</span><p>Aaron</p><p>Isaac</p><p>Jehovah</p
            ><span>1.1.1</span><span>Place-names</span><p>Israel</p><p>Judea</p
            ><span>1.2</span><span>Preamble</span><p>Translated from the Aramaic</p
            ><span>1.2.1</span><span>Translators</span><p>King James</p
            ><span>1.3</span><span>Bibliography</span
            ><p>Genesis</p><p>Exodus</p><p>Job</p><p>Leviticus</p></doc>]]></assert-xml>
      </result>
   </test-case>

   <test-case name="accumulator-011">
      <description>Hierarchic section numbers: uses accumulator rules with phase=end. Once more with streaming.</description>
      <keywords>xsl:mode on-no-match-attribute streamable shallow-copy streamable fn:accumulator-before</keywords>
      <created by="Michael Kay" on="2012-11-07"/>
      <environment ref="accumulator-005s"/>
      <dependencies>
         <feature value="streaming"/>
      </dependencies>
      <test>
         <stylesheet file="accumulator-011.xsl"/>
      </test>
      <result>
         <assert-xml><![CDATA[<doc><span>1</span><span>Intro</span><p>In the beginning</p
            ><span>1.1</span><span>Terminology</span><p>Aaron</p><p>Isaac</p><p>Jehovah</p
            ><span>1.1.1</span><span>Place-names</span><p>Israel</p><p>Judea</p
            ><span>1.2</span><span>Preamble</span><p>Translated from the Aramaic</p
            ><span>1.2.1</span><span>Translators</span><p>King James</p
            ><span>1.3</span><span>Bibliography</span
            ><p>Genesis</p><p>Exodus</p><p>Job</p><p>Leviticus</p></doc>]]></assert-xml>
      </result>
   </test-case>
   
   <test-case name="accumulator-012">
      <description>Accumulator matching text node</description>
      <keywords>xsl:mode on-no-match-attribute shallow-copy TextTest fn:accumulator-after</keywords>
      <created by="Michael Kay" on="2013-09-07"/>
      <environment ref="accumulator-005"/>
      <dependencies/>
      <test>
         <stylesheet file="accumulator-012.xsl"/>
      </test>
      <result>
         <assert-xml><![CDATA[<doc><head>Intro</head><p>In the beginning</p><head>Terminology</head
         ><p>Aaron</p><p>Isaac</p><p>Jehovah</p><head>Place-names</head
         ><p>Israel</p><p>Judea</p><last>Judea</last><last>Judea</last
         ><head>Preamble</head><p>Translated from the Aramaic</p><head>Translators</head
         ><p>King James</p><last>King James</last><last>King James</last><head>Bibliography</head
         ><p>Genesis</p><p>Exodus</p><p>Job</p><p>Leviticus</p><last>Leviticus</last
         ><last>Leviticus</last></doc>]]></assert-xml>
      </result>
   </test-case>
   
   <test-case name="accumulator-013">
      <description>Accumulator matching text node - streamable</description>
      <keywords>xsl:mode on-no-match-attribute shallow-copy TextTest fn:accumulator-after streamable</keywords>
      <created by="Michael Kay" on="2013-09-07"/>
      <environment ref="accumulator-005s"/>
      <dependencies/>
      <test>
         <stylesheet file="accumulator-013.xsl"/>
      </test>
      <result>
         <assert-xml><![CDATA[<doc><head>Intro</head><p>In the beginning</p><head>Terminology</head
         ><p>Aaron</p><p>Isaac</p><p>Jehovah</p><head>Place-names</head
         ><p>Israel</p><p>Judea</p><last>Judea</last><last>Judea</last
         ><head>Preamble</head><p>Translated from the Aramaic</p><head>Translators</head
         ><p>King James</p><last>King James</last><last>King James</last><head>Bibliography</head
         ><p>Genesis</p><p>Exodus</p><p>Job</p><p>Leviticus</p><last>Leviticus</last
         ><last>Leviticus</last></doc>]]></assert-xml>
      </result>
   </test-case>
   
   <test-case name="accumulator-014">
      <description>Local use of $value to cause confusion</description>
      <keywords>xsl:mode on-no-match-attribute shallow-skip fn:accumulator-before $value</keywords>
      <created by="Michael Kay" on="2013-11-07"/>
      <environment ref="accumulator-001"/>
      <test>
         <stylesheet file="accumulator-014.xsl"/>
      </test>
      <result>
         <assert-xml><![CDATA[<figures><p>Figure 1: a diagram</p><p>Figure 2: another diagram</p><p>Figure 1: a third diagram</p><p>Figure 2: a fourth diagram</p></figures>]]></assert-xml>
      </result>
   </test-case>
   
   <test-case name="accumulator-015">
      <description>Use post-descent accumulator function</description>
      <keywords>xsl:mode streamable post-descent non-streamable _WRONG:illegal-accumulator-streaming-non-streaming</keywords>
      <created by="Michael Kay" on="2013-12-20"/>
      <environment ref="accumulator-015s"/>
      <test>
         <stylesheet file="accumulator-015.xsl"/>
      </test>
      <result>
         <assert-xml><![CDATA[<figures><p>Figure 1: a diagram</p><p>Figure 2: another diagram</p><p>Figure 1: a third diagram</p><p>Figure 2: a fourth diagram</p></figures>]]></assert-xml>
      </result>
   </test-case>
</test-set>