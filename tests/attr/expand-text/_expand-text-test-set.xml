<?xml version="1.0" encoding="UTF-8"?>
<test-set xmlns="http://www.w3.org/2012/10/xslt-test-catalog" xmlns:xs="http://www.w3.org/2001/XMLSchema" name="expand-text">
   <description>Tests the XSLT 3.0 expand-text attribute and content value templates</description>

   <test-case name="cvt-001">
      <description>Simple test of content value templates</description>
      <keywords>expand-text-attribute xsl:stylesheet variable-reference lre</keywords>
      <created by="Michael Kay" on="2013-01-25"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-001.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = "Goodbye Mars!"</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-002">
      <description>No expansion if expand-text = "no"</description>
      <keywords>expand-text-attribute xsl:stylesheet variable-reference lre</keywords>
      <created by="Michael Kay" on="2013-01-25"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-002.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = "{$Hello} {$World}!"</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-003">
      <description>Expansion enabled at element level</description>
      <keywords>xsl:stylesheet expand-text-attribute lre xsl:expand-text-attribute expand-override variable-reference</keywords>
      <created by="Michael Kay" on="2013-01-25"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-003.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = "Goodbye Mars!"</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-004">
      <description>Expansion enabled at template level</description>
      <keywords>xsl:stylesheet expand-text-attribute expand-override lre variable-reference</keywords>
      <created by="Michael Kay" on="2013-01-25"/>      
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-004.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = "Goodbye Mars!"</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-005">
      <description>Atomization</description>
      <keywords>xsl:stylesheet expand-override variable-reference xsl:template lre</keywords>
      <created by="Michael Kay" on="2013-01-25"/>
      <modified by="Debbie Lockett" on="2014-08-05" change="use expand-text='true' and 'false'"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-005.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
          <assert>/out = " !"</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-006">
      <description>Space separation</description>
      <keywords>xsl:stylesheet expand-override expand-text-attribute xsl:template numeric-literals lre</keywords>
      <created by="Michael Kay" on="2013-01-25"/>
      <modified by="Debbie Lockett" on="2014-08-05" change="use expand-text='1' and '0'"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-006.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = "1 2 3 45 6"</assert>         
      </result>
   </test-case>
   
   <test-case name="cvt-007">
      <description>Use in xsl:attribute</description>
      <keywords>expand-text-attribute xsl:template xsl:stylesheet xsl:attribute numeric-literals</keywords>
      <created by="Michael Kay" on="2013-01-25"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-007.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <all-of>
            <assert>/out/@a = "1 2 3 45 6"</assert>
            <assert>/out/@b = "1 2 3 45 6"</assert>
         </all-of>
      </result>
   </test-case>
   
   <test-case name="cvt-008">
      <description>expand-text is not an AVT</description>
      <keywords>XTSE0020 expand-text-attribute xsl:template wrong-attribute-value</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-008.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <error code="XTSE0020"/>
      </result>
   </test-case>
   
   <test-case name="cvt-009">
      <description>expand-text must be yes or no</description>
      <keywords>XTSE0020 wrong-attribute-value expand-text-attribute xsl:template xsl:stylesheet</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <modified by="Debbie Lockett" on="2014-08-05" change="expand-text must be yes|no|true|false|1|0, e.g. not TRUE"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-009.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <error code="XTSE0020"/>
      </result>
   </test-case>
   
   <test-case name="cvt-010">
      <description>expand-text must be yes or no</description>
      <keywords>expand-text-attribute xsl:stylesheet xsl:template wrong-attribute-value</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <modified by="Debbie Lockett" on="2014-08-05" change="expand-text must be yes|no|true|false|1|0, e.g. not empty"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-010.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <error code="XTSE0020"/>
      </result>
   </test-case>
   
   <test-case name="cvt-011">
      <description>variables declared in a preceding sibling are in scope</description>
      <keywords>expand-text-attribute xsl:template variable-reference scope</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-011.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = '2'</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-012">
      <description>variables declared in a preceding uncle are in scope</description>
      <keywords>lre expand-text-attribute variable-reference xsl:template</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-012.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = '2'</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-013">
      <description>No elements allowed within curlies</description>
      <keywords>XTSE0350 XPST0003 invalid-expression expand-text-attribute xsl:template lre</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-013.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <any-of>
           <error code="XTSE0350"/>
           <error code="XPST0003"/>
         </any-of>
      </result>
   </test-case>
   
   <test-case name="cvt-014">
      <description>Nested expression containing curlies</description>
      <keywords>expand-text-attribute xsl:template variable-reference nested-curlies lre</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-014.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = '4'</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-015">
      <description>Nested expression ending in a right curly</description>
      <keywords>xsl:template expand-text-attribute lre nested-curlies</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-015.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = '4'</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-016">
      <description>Nested expression ending in a right curly: now allowed under resolution of bug 20874</description>
      <keywords>bug-20874 expand-text-attribute xsl:template nested-curlies lre</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-016.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = "4"</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-017">
      <description>CVT not recognized in xsl:text</description>
      <keywords>expand-text-attribute xsl:template xsl:text lre</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <modified by="Michael Kay" on="2014-08-22" change="See bug 26525"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-017.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = '4'</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-018">
      <description>CVT not recognized in xsl:text, but expand-text not rejected</description>
      <keywords>xsl:expand-text-attribute lre xsl:text</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <modified by="Michael Kay" on="2014-08-22" change="See bug 26525"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-018.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = '4'</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-019">
      <description>expand-text=yes rejected on xsl:text</description>
      <keywords>expand-text-attribute xsl:text lre</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <modified by="Michael Kay" on="2014-08-22" change="See bug 26525"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-019.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = '4'</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-020">
      <description>expand-text=no not rejected on xsl:text</description>
      <keywords>expand-text-attribute xsl:text lre</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-020.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = '{2+2}'</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-021">
      <description>doubled braces for escaping</description>
      <keywords>xsl:expand-text-attribute lre escaped-curlies</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-021.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = '{2+2}'</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-022">
      <description>doubled braces with expand-text="no"</description>
      <keywords>lre expand-text-attribute escaped-curlies</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-022.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = '{{2+2}}'</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-023">
      <description>closing brace inside a comment</description>
      <keywords>lre expand-text-attribute xpath-comments</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-023.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = 'The Lord of the Rings'</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-024">
      <description>closing brace inside a string literal</description>
      <keywords>lre xsl:expand-text-attribute nested-curlies</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-024.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = "{The value of a}"</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-025">
      <description>Use typed value not string value</description>
      <keywords>xsl:expand-text-attribute typed-value variable-reference lre</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <dependencies>
         <spec value="XSLT30+"/>
         <feature value="schema_aware"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-025.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = "23"</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-026">
      <description>Base uri in static context for CVT expression</description>
      <keywords>lre xsl:template expand-text-attribute static-context fn:static-base-uri xml:base-attribute</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <dependencies>
         <spec value="XSLT30+"/>
         <feature value="schema_aware"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-026.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = "http://www.example.com/cvt"</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-027">
      <description>Namespaces in static context for CVT expression</description>
      <keywords>static-context expand-text-attribute namespace-resolution variable-reference EQName</keywords>
      <created by="Michael Kay" on="2013-02-05"/>
      <dependencies>
         <spec value="XSLT30+"/>
         <feature value="schema_aware"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-027.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <assert>/out = "London"</assert>
      </result>
   </test-case>
   
   <test-case name="cvt-028">
      <description>Call to current() in CVT expression</description>
      <keywords>dynamic-context expand-text-attribute xsl:template fn:current xsl:for-each</keywords>
      <created by="Michael Kay" on="2013-09-22"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-028.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <all-of>
            <assert>/out/n[1] = ""</assert>
            <assert>/out/n[2] = ""</assert>
            <assert>/out/n[3] = "3"</assert>
            <assert>empty(/out/n[4])</assert>
         </all-of>   
      </result>
   </test-case>
   
   <test-case name="cvt-029">
      <description>TVT as result of function</description>
      <keywords>expand-text-attribute</keywords>
      <created by="Michael Kay" on="2014-10-04"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-029.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <all-of>
            <assert>/out = "3"</assert>
         </all-of>   
      </result>
   </test-case>
   
   <test-case name="cvt-029b">
      <description>TVT as result of function: must be a text node</description>
      <keywords>expand-text-attribute</keywords>
      <created by="Michael Kay" on="2015-07-01"/>
      <dependencies>
         <spec value="XSLT30+"/>
      </dependencies>
      <test>
         <stylesheet file="cvt-030.xsl"/>
         <initial-template name="main"/>
      </test>
      <result>
         <all-of>
            <assert>/out = "true"</assert>
         </all-of>   
      </result>
   </test-case>



 
</test-set>